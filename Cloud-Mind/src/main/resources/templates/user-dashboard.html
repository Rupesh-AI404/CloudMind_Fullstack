<!DOCTYPE html>
<html lang="en" data-bs-theme="light" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard - Cloud Mind</title>
    <meta name="description" content="User dashboard for managing your digital marketing campaigns and tracking performance.">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/styles.css">


    <style>
        .dropdown-menu {
            z-index: 1050 !important;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        }
    </style>

    <style>
        #userProfileImage {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-size: cover;
        }

        #userProfileImage[src=""], #userProfileImage[src="/images/default-avatar.png"] {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E");
        }
    </style>

</head>
<body>
<!-- Navbar -->
<div th:replace="~{fragments/navbar :: navbar}"></div>

<!-- Dashboard Content -->
<main style="padding-top: 140px; min-height: 100vh; background: var(--bg-secondary);">
    <div class="container">
        <!-- Dashboard Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="glass-card p-4">
                    <div class="row align-items-center">
                        <div class="col-lg-8">
                            <div class="d-flex align-items-center flex-wrap">
                                <!-- Profile Image Section -->
                                <div class="position-relative me-4 mb-3 mb-lg-0">
                                    <img th:src="@{'/image/user/' + ${session.email}}"
                                         src="/images/default-avatar.png"
                                         alt="Profile Picture"
                                         class="rounded-circle mb-3"
                                         style="width: 100px; height: 100px; object-fit: cover; border: 3px solid #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.15);"
                                         id="userProfileImage">

                                    <!-- Camera button -->
                                    <button class="btn btn-primary btn-sm position-absolute bottom-0 end-0 rounded-circle"
                                            onclick="openImageUpload()"
                                            style="width: 28px; height: 28px; padding: 0;"
                                            title="Change Profile Picture">
                                        <i class="bi bi-camera"></i>
                                    </button>

                                    <!-- Hidden Upload Form -->
                                    <form id="profileImageForm"
                                          th:action="@{/uploadImage}"
                                          method="post"
                                          enctype="multipart/form-data"
                                          style="display: none;">
                                        <input type="file"
                                               id="profileImageInput"
                                               name="image"
                                               accept="image/*"
                                               onchange="previewImage(this)">
                                    </form>
                                </div>

                                <!-- User Info -->
                                <div class="flex-grow-1">
                                    <h1 class="h3 mb-1 fw-bold">Welcome back, <span th:text="${session.activeUser}">User</span>!</h1>
                                    <p class="text-muted mb-2">Here's an overview of your marketing campaigns and performance.</p>
                                    <div>
                                        <span class="badge bg-success me-2" th:text="${session.userRole}">Member</span>
                                        <span class="small text-muted">Member since Jan 2025</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="d-flex gap-2 justify-content-lg-end justify-content-start mt-3 mt-lg-0">
                                <button href="#" onclick="downloadReport()" class="btn btn-outline-primary">
                                    <i class="bi bi-download me-2"></i>Download Report
                                </button>



                                <div class="dropdown">
                                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <i class="bi bi-person-gear me-1"></i>Settings
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end">
                                        <li><a class="dropdown-item" href="#" onclick="openImageUpload()"><i class="bi bi-camera me-2"></i>Change Profile Picture</a></li>
                                        <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#editProfileModal"><i class="bi bi-person me-2"></i>Edit Profile</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item text-danger" href="/logout"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                </div>
        <!-- Success/Error Messages -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show mb-4" role="alert">
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- My Subscription -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="glass-card p-0 overflow-hidden">
                    <!-- Enhanced Header -->
                    <div class="px-4 py-3" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white;">
                        <div class="d-flex justify-content-between align-items-center flex-wrap">
                            <div class="d-flex align-items-center mb-2 mb-md-0">
                                <i class="bi bi-star-fill me-3 fs-4"></i>
                                <div>
                                    <h4 class="mb-0 fw-bold">My Subscription</h4>
                                    <small class="opacity-75">Manage your plan and billing</small>
                                </div>
                            </div>
                            <button class="btn btn-light btn-sm">
                                <i class="bi bi-arrow-clockwise me-1"></i>Refresh
                            </button>
                        </div>
                    </div>

                    <div class="p-4">
                        <!-- Active Subscription Display -->
                        <div th:if="${hasActiveSubscription and activeSubscription != null}">
                            <div class="row g-4 mb-4">
                                <!-- Plan Details Card -->
                                <div class="col-lg-8">
                                    <div class="p-4 rounded-3 h-100" style="background: var(--glass-bg); border: 1px solid rgba(255,255,255,0.1);">
                                        <div class="d-flex align-items-center mb-3 flex-wrap">
                                            <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3 mb-2 mb-md-0" style="width: 50px; height: 50px;">
                                                <i class="bi bi-gem fs-5"></i>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h5 class="mb-1 fw-bold text-capitalize" th:text="${activeSubscription.plan ?: 'Professional'}">Professional</h5>
                                                <div class="d-flex align-items-center gap-2 flex-wrap">
                                                        <span th:class="${activeSubscription.status == 'ACTIVE' ? 'badge bg-success' : 'badge bg-danger'}"
                                                              th:text="${activeSubscription.status ?: 'ACTIVE'}">ACTIVE</span>
                                                    <span class="badge bg-light text-dark" th:text="${activeSubscription.billing ?: 'Monthly'}">Monthly</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Features -->
                                        <div class="mb-3">
                                            <div th:switch="${activeSubscription.plan ?: 'professional'}">
                                                <div th:case="'starter'" class="small text-muted">
                                                    âœ“ 5 Campaigns â€¢ âœ“ Basic Analytics â€¢ âœ“ Email Support
                                                </div>
                                                <div th:case="'professional'" class="small text-muted">
                                                    âœ“ 25 Campaigns â€¢ âœ“ Advanced Analytics â€¢ âœ“ Priority Support
                                                </div>
                                                <div th:case="'enterprise'" class="small text-muted">
                                                    âœ“ Unlimited â€¢ âœ“ Custom Analytics â€¢ âœ“ 24/7 Support
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Price -->
                                        <div class="d-flex justify-content-between align-items-center flex-wrap">
                                            <div class="mb-2 mb-md-0">
                                                    <span class="h4 mb-0 fw-bold text-primary">
                                                        <span th:switch="${activeSubscription.plan ?: 'professional'}">
                                                            <span th:case="'starter'">$999</span>
                                                            <span th:case="'professional'">$2499</span>
                                                            <span th:case="'enterprise'">$4999</span>
                                                        </span>
                                                    </span>
                                                <span class="text-muted ms-1">/ month</span>
                                            </div>
                                            <div class="d-flex gap-2 flex-wrap">
<!--                                                <button class="btn btn-outline-primary btn-sm">-->
<!--                                                    <i class="bi bi-arrow-up-circle me-1" th:href="${subscription}"></i>Upgrade-->
<!--                                                </button>-->
                                                <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#managePlanModal">
                                                    <i class="bi bi-gear me-1"></i>Manage
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Billing Timeline -->
                                <div class="col-lg-4">
                                    <div class="p-4 rounded-3 h-100 text-center" style="background: linear-gradient(135deg, #fef3c7, #fbbf24); color: #92400e;">
                                        <i class="bi bi-calendar-event fs-3 mb-3"></i>
                                        <h6 class="fw-bold mb-3">Next Billing</h6>
                                        <div class="fw-bold fs-4 mb-1">15</div>
                                        <small class="opacity-75">Oct 2025</small>
                                        <div class="mt-3">
                                            <div class="progress" style="height: 4px;">
                                                <div class="progress-bar" style="width: 75%; background: #92400e;"></div>
                                            </div>
                                            <small class="mt-1 d-block">75% of cycle</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- No Subscription State -->
                        <div th:if="${!hasActiveSubscription or activeSubscription == null}">
                            <div class="text-center py-4">
                                <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                                    <i class="bi bi-credit-card-2-front fs-3 text-muted"></i>
                                </div>
                                <h5 class="fw-bold mb-2">No Active Subscription</h5>
                                <p class="text-muted mb-4">Choose a plan to unlock premium features.</p>

                                <div class="row g-2 mb-4 justify-content-center">
                                    <div class="col-4 col-md-3 col-lg-2">
                                        <div class="p-3 rounded-3 border text-center">
                                            <div class="fw-bold text-primary">$999</div>
                                            <small class="text-muted">Starter</small>
                                        </div>
                                    </div>
                                    <div class="col-4 col-md-3 col-lg-2">
                                        <div class="p-3 rounded-3 border border-primary text-center" style="background: rgba(99, 102, 241, 0.05);">
                                            <div class="fw-bold text-primary">$2499</div>
                                            <small class="text-muted">Professional</small>
                                        </div>
                                    </div>
                                    <div class="col-4 col-md-3 col-lg-2">
                                        <div class="p-3 rounded-3 border text-center">
                                            <div class="fw-bold text-primary">$4999</div>
                                            <small class="text-muted">Enterprise</small>
                                        </div>
                                    </div>
                                </div>

                                <a th:href="@{/subscription}" class="btn btn-primary">
                                    <i class="bi bi-plus-circle me-2"></i>Choose Plan
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Chart & Recent Campaigns -->
        <div class="row g-4 mb-4">
            <div class="col-xl-6 mb-4 mb-xl-0">
                <div class="glass-card p-4 h-100">
                    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
                        <h5 class="fw-bold mb-2 mb-md-0">Campaign Performance</h5>
                        <div class="btn-group" role="group">
                            <input type="radio" class="btn-check" name="userTimeRange" id="userWeek" checked>
                            <label class="btn btn-outline-primary btn-sm" for="userWeek">7D</label>
                            <input type="radio" class="btn-check" name="userTimeRange" id="userMonth">
                            <label class="btn btn-outline-primary btn-sm" for="userMonth">30D</label>
                            <input type="radio" class="btn-check" name="userTimeRange" id="userYear">
                            <label class="btn btn-outline-primary btn-sm" for="userYear">3M</label>
                        </div>
                    </div>
                    <div class="chart-container d-flex align-items-end justify-content-center gap-2" style="height: 200px;">
                        <div class="chart-bar" style="height: 35%; background: var(--brand-gradient);"></div>
                        <div class="chart-bar" style="height: 55%; background: var(--brand-gradient);"></div>
                        <div class="chart-bar" style="height: 45%; background: var(--brand-gradient);"></div>
                        <div class="chart-bar" style="height: 70%; background: var(--brand-gradient);"></div>
                        <div class="chart-bar" style="height: 85%; background: var(--brand-gradient);"></div>
                        <div class="chart-bar" style="height: 65%; background: var(--brand-gradient);"></div>
                        <div class="chart-bar" style="height: 90%; background: var(--brand-gradient);"></div>
                    </div>
                </div>
            </div>
            <div class="col-xl-6">
                <div class="glass-card p-4 h-100">
                    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
                        <h5 class="fw-bold mb-2 mb-md-0">Recent Campaigns</h5>
                        <a href="#" class="btn btn-outline-primary btn-sm">View All</a>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th class="border-0 small text-muted">Campaign</th>
                                <th class="border-0 small text-muted d-none d-md-table-cell">Type</th>
                                <th class="border-0 small text-muted">Status</th>
                                <th class="border-0 small text-muted d-none d-lg-table-cell">Performance</th>
                                <th class="border-0 small text-muted">Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td class="border-0">
                                    <div>
                                        <div class="fw-semibold">Summer Sale 2024</div>
                                        <div class="small text-muted">Created 2 days ago</div>
                                    </div>
                                </td>
                                <td class="border-0 d-none d-md-table-cell">
                                    <span class="badge bg-primary">Social Media</span>
                                </td>
                                <td class="border-0">
                                    <span class="badge bg-success">Active</span>
                                </td>
                                <td class="border-0 d-none d-lg-table-cell">
                                    <div class="small">
                                        <div class="text-success">â†— 24.5% CTR</div>
                                        <div class="text-muted">1.2K clicks</div>
                                    </div>
                                </td>
                                <td class="border-0">
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-primary btn-sm">Edit</button>
                                        <button class="btn btn-outline-secondary btn-sm d-none d-md-inline-block">View</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="border-0">
                                    <div>
                                        <div class="fw-semibold">Product Launch</div>
                                        <div class="small text-muted">Created 1 week ago</div>
                                    </div>
                                </td>
                                <td class="border-0 d-none d-md-table-cell">
                                    <span class="badge bg-warning">Email</span>
                                </td>
                                <td class="border-0">
                                    <span class="badge bg-success">Active</span>
                                </td>
                                <td class="border-0 d-none d-lg-table-cell">
                                    <div class="small">
                                        <div class="text-success">â†— 18.2% Open Rate</div>
                                        <div class="text-muted">3.4K opens</div>
                                    </div>
                                </td>
                                <td class="border-0">
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-primary btn-sm">Edit</button>
                                        <button class="btn btn-outline-secondary btn-sm d-none d-md-inline-block">View</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="border-0">
                                    <div>
                                        <div class="fw-semibold">Brand Awareness</div>
                                        <div class="small text-muted">Created 2 weeks ago</div>
                                    </div>
                                </td>
                                <td class="border-0 d-none d-md-table-cell">
                                    <span class="badge bg-info">Display Ads</span>
                                </td>
                                <td class="border-0">
                                    <span class="badge bg-secondary">Paused</span>
                                </td>
                                <td class="border-0 d-none d-lg-table-cell">
                                    <div class="small">
                                        <div class="text-warning">â†— 12.1% CTR</div>
                                        <div class="text-muted">856 clicks</div>
                                    </div>
                                </td>
                                <td class="border-0">
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-primary btn-sm">Resume</button>
                                        <button class="btn btn-outline-secondary btn-sm d-none d-md-inline-block">View</button>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
        </div>
    </div>
    </div>
</main>


<!-- Plan Management Modal -->
<div class="modal fade" id="managePlanModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Manage Subscription</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="list-group">
                    <a th:href="@{/subscription}" class="list-group-item list-group-item-action">
                        <i class="bi bi-credit-card me-2"></i>Update Payment Method
                    </a>
                    <a href="#" onclick="downloadReport()" class="list-group-item list-group-item-action">
                        <i class="bi bi-receipt me-2"></i>Download Report
                    </a>
                    <a href="#" onclick="confirmCancelSubscription()" class="list-group-item list-group-item-action text-danger">
                        <i class="bi bi-x-circle me-2"></i>Cancel Subscription
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Cancel Subscription Confirmation Modal -->
<div class="modal fade" id="cancelSubscriptionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title text-danger">
                    <i class="bi bi-exclamation-triangle me-2"></i>Cancel Subscription
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center py-4">
                <div class="mb-4">
                    <i class="bi bi-exclamation-circle text-warning" style="font-size: 4rem;"></i>
                </div>
                <h6 class="fw-bold mb-3">Are you sure you want to cancel your subscription?</h6>
                <p class="text-muted mb-4">
                    This action will immediately cancel your subscription and you'll lose access to premium features.
                    You can resubscribe at any time.
                </p>
                <div class="alert alert-warning" role="alert">
                    <strong>Note:</strong> This action cannot be undone. All premium features will be disabled immediately.
                </div>
            </div>
            <div class="modal-footer border-0 justify-content-center">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-arrow-left me-1"></i>Keep Subscription
                </button>
                <button type="button" class="btn btn-danger" onclick="cancelSubscription()">
                    <i class="bi bi-trash me-1"></i>Yes, Cancel Subscription
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Profile</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form th:action="@{/updateProfile}" method="post" id="editProfileForm">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editName" class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="editName" name="fullName"
                               th:value="${session.activeUser}" required>
                    </div>
                    <div class="mb-3">
                        <label for="editEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="editEmail"
                               th:value="${session.email}" readonly>
                        <small class="text-muted">Email cannot be changed</small>
                    </div>
                    <div class="mb-3">
                        <label for="editPhone" class="form-label">Phone</label>
                        <input type="tel" class="form-control" id="editPhone" name="phone"
                               th:value="${userProfile?.phone}" placeholder="Enter phone number">
                    </div>
                    <div class="mb-3">
                        <label for="editBio" class="form-label">Bio</label>
                        <textarea class="form-control" id="editBio" name="bio" rows="3"
                                  th:text="${userProfile?.bio}" placeholder="Tell us about yourself"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="editCompany" class="form-label">Company</label>
                        <input type="text" class="form-control" id="editCompany" name="company"
                               th:value="${userProfile?.company}" placeholder="Your company name">
                    </div>
                    <div class="mb-3">
                        <label for="editLocation" class="form-label">Location</label>
                        <input type="text" class="form-control" id="editLocation" name="location"
                               th:value="${userProfile?.location}" placeholder="City, Country">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-lg me-1"></i>Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="footer-modern py-5 mt-5">
    <div class="container">
        <div class="row gy-4 gx-5">
            <div class="col-6 col-md-3 col-lg-2">
                <h6 class="footer-heading">SERVICES</h6>
                <ul class="footer-list">
                    <li><a href="services.html">Content Marketing</a></li>
                    <li><a href="services.html">Data Analytics</a></li>
                    <li><a href="services.html">Audience Targeting</a></li>
                    <li><a href="services.html">Social Media Marketing</a></li>
                    <li><a href="services.html">SEO Optimization</a></li>
                    <li><a href="services.html">Performance Optimization</a></li>
                </ul>
            </div>
            <div class="col-6 col-md-3 col-lg-2">
                <h6 class="footer-heading">COMPANY</h6>
                <ul class="footer-list">
                    <li><a href="about.html">About</a></li>
                    <li><a href="#">Careers</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><a href="#">Terms</a></li>
                    <li><a href="#">Privacy</a></li>
                </ul>
            </div>
            <div class="col-6 col-md-3 col-lg-2">
                <h6 class="footer-heading">RESOURCES</h6>
                <ul class="footer-list">
                    <li><a href="#">Blog</a></li>
                    <li><a href="#">Documentation</a></li>
                    <li><a href="#">Community</a></li>
                    <li><a href="#">Events</a></li>
                    <li><a href="#">Guides</a></li>
                </ul>
            </div>
            <div class="col-6 col-md-3 col-lg-3">
                <h6 class="footer-heading">GUIDES</h6>
                <ul class="footer-list">
                    <li><a href="#">Digital Marketing Guide</a></li>
                    <li><a href="#">SEO Best Practices</a></li>
                    <li><a href="#">Content Strategy</a></li>
                    <li><a href="#">Analytics & Reporting</a></li>
                    <li><a href="#">Automation Tools</a></li>
                </ul>
            </div>
            <div class="col-12 col-lg-3">
                <h6 class="footer-heading">FOLLOW US</h6>
                <div class="footer-social d-flex gap-3 mt-2">
                    <a href="#" class="footer-social-icon" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
                    <a href="#" class="footer-social-icon" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
                    <a href="#" class="footer-social-icon" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
                    <a href="#" class="footer-social-icon" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
                </div>
            </div>
        </div>
        <hr class="footer-divider my-4">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-center">
            <div class="footer-copyright mb-2 mb-md-0">
                &copy; 2025 Cloud Mind Agency. All rights reserved.
            </div>
            <div class="footer-legal">
                <a href="#" class="me-3">Terms of Use</a>
                <a href="#">Privacy Policy</a>
            </div>
        </div>
    </div>
</footer>

<!-- Bootstrap JS -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/auth.js}"></script>
<script th:src="@{/js/script.js}"></script>

<script>
    function openImageUpload() {
        document.getElementById("profileImageInput").click();
    }

    function previewImage(input) {
        if (input.files && input.files[0]) {
            const file = input.files[0];

            // Validate file size before preview
            if (file.size > 2 * 1024 * 1024) {
                alert('File size should be less than 2MB');
                input.value = ''; // Clear the input
                return;
            }

            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please select a valid image file');
                input.value = ''; // Clear the input
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                // Update the profile image immediately
                document.getElementById('userProfileImage').src = e.target.result;

                // Auto-submit the form after preview
                setTimeout(() => {
                    document.getElementById('profileImageForm').submit();
                }, 500);
            }
            reader.readAsDataURL(file);
        }
    }

    // Prevent multiple submissions
    let isSubmitting = false;
    document.getElementById('profileImageForm').addEventListener('submit', function(e) {
        if (isSubmitting) {
            e.preventDefault();
            return;
        }
        isSubmitting = true;
    });

    // Download user report
    function downloadReport() {
        // Show loading state
        const originalText = event.target.innerHTML;
        event.target.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Generating...';
        event.target.style.pointerEvents = 'none';

        // Call the download endpoint
        fetch('/downloadReport', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            }
        })
            .then(response => {
                if (response.ok) {
                    return response.blob();
                }
                throw new Error('Failed to generate report');
            })
            .then(blob => {
                // Create download link
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'subscription-report.pdf';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);

                // Show success message
                alert('Report downloaded successfully!');
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to download report. Please try again.');
            })
            .finally(() => {
                // Restore button state
                event.target.innerHTML = originalText;
                event.target.style.pointerEvents = 'auto';
            });
    }

    // Show cancel confirmation modal
    function confirmCancelSubscription() {
        // Close manage plan modal first
        const managePlanModal = bootstrap.Modal.getInstance(document.getElementById('managePlanModal'));
        managePlanModal.hide();

        // Show cancel confirmation modal
        setTimeout(() => {
            const cancelModal = new bootstrap.Modal(document.getElementById('cancelSubscriptionModal'));
            cancelModal.show();
        }, 300);
    }

    // Cancel subscription
    function cancelSubscription() {
        const cancelBtn = document.querySelector('#cancelSubscriptionModal .btn-danger');
        const originalText = cancelBtn.innerHTML;

        cancelBtn.innerHTML = '<i class="bi bi-hourglass-split me-1"></i>Cancelling...';
        cancelBtn.disabled = true;

        fetch('/cancelSubscription', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            }
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Close modal
                    const cancelModal = bootstrap.Modal.getInstance(document.getElementById('cancelSubscriptionModal'));
                    if (cancelModal) {
                        cancelModal.hide();
                    }

                    alert('âœ… Subscription cancelled successfully!\n\nðŸ“§ Confirmation emails have been sent to you and admin.');

                    // Force complete page reload with cache busting
                    window.location.href = '/user-dashboard?cancelled=true&t=' + Date.now();

                } else {
                    alert('âŒ Failed to cancel subscription: ' + (data.message || 'Unknown error'));
                    cancelBtn.innerHTML = originalText;
                    cancelBtn.disabled = false;
                }
            })
            .catch(error => {
                alert('âŒ Failed to cancel subscription: ' + error.message);
                cancelBtn.innerHTML = originalText;
                cancelBtn.disabled = false;
            });
    }





        // Add this to your dashboard page for debugging
        document.addEventListener('DOMContentLoaded', function() {
            // Debug what's in the database
            fetch('/debugSubscription')
                .then(response => response.json())
                .then(data => {
                    console.log('Database subscriptions:', data.subscriptions);
                });
        });


</script>

</body>
</html>